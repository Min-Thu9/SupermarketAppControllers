<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Search Results</title>
  <style>
    body {
      background: #f8f9fa;
      font-family: 'Poppins', sans-serif;
    }
    .card {
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s ease-in-out;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card-img-top {
      border-radius: 10px;
      object-fit: cover;
      height: 150px;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-sm bg-dark navbar-dark shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="/">ðŸ›’ Supermarket App</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
        <a href="/shopping" class="btn btn-secondary">Back to Shopping</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mt-5">
    <% if (products.length === 0) { %>
      <p class="text-center fw-semibold">No products found for "<%= searchQuery %>"</p>
    <% } else { %>
      <p class="text-center fw-semibold mb-4">Found <%= products.length %> product(s) for "<%= searchQuery %>"</p>

      <div class="row g-4">
        <% products.forEach(product => { %>
          <div class="col-md-4">
            <div class="card h-100 text-center p-3">
              <% if (product.image) { %>
                <img src="/images/<%= product.image %>" class="card-img-top mx-auto" style="width: 60%;">
              <% } else { %>
                <img src="/images/default.png" class="card-img-top mx-auto" style="width: 60%;">
              <% } %>
              <div class="card-body">
                <h5 class="card-title fw-semibold"><%= product.productName %></h5>
                <p class="text-muted">$<%= product.price.toFixed(2) %></p>

                <% if (user && user.role === 'user') { %>
                  <% if (product.quantity > 0) { %>
                    <form action="/add-to-cart/<%= product.id %>" method="POST">
                      <select class="form-select mb-2" name="quantity" style="max-width: 100px; margin: 0 auto;">
                        <% for (let q = 1; q <= Math.min(5, product.quantity); q++) { %>
                          <option value="<%= q %>"><%= q %></option>
                        <% } %>
                      </select>
                      <button type="submit" class="btn btn-secondary w-100">Add to Cart</button>
                    </form>
                  <% } else { %>
                    <div class="alert alert-warning py-1 my-2">Out of Stock</div>
                  <% } %>
                <% } %>

                <% if (user && user.role === 'admin') { %>
                  <a href="/updateProduct/<%= product.id %>" class="btn btn-sm btn-warning me-2 mt-2">Edit</a>
                  <a href="/deleteProduct/<%= product.id %>" class="btn btn-sm btn-danger mt-2" onclick="return confirm('Are you sure you want to delete this product?')">Delete</a>
                <% } %>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>

</body>
</html>